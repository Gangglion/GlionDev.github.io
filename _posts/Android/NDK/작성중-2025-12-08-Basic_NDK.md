---
title: "NDK 와 JNI 기본"
date: 2025-12-08 14:47:24 +0900
categories: [Android, NDK]
tags: [Android, NDK, JNI, C++, Native Development Kit, Java Native Interface]
---

## NDK 란
**N**ative **D**evelopment **K**it 의 약자로서, Android 앱 개발 시 Java/Kotlin 코드와 상호작용 할 수 있도록 C/C++ 라이브러리를 지원하는 툴킷이다.

주로 고성능 그래픽처리나 오디오 신호 처리 등 **JVM 보다 빠른 연산 속도가 필요한 작업**에 활용된다.

C/C++ 코드를 사용하여 무거운 연산의 성능 최적화뿐만 아니라 FFmpeg, OpenCV 등 레거시 C/C++ 라이브러리를 안드로이드 앱에 이식할때 필수적으로 사용된다.

## JNI 란
**J**ava **N**ative **I**nterface 의 약자로서, Java/Kotlin 코드와 NDK로 작성된 C/C++ 코드가 서로 통신할 수 있도록 연결해 주는 인터페이스 이다.

두 언어 환경 사이에 브릿지 역할을 하여, Java/Kotlin 에서 Nativa 함수를 호출하여 결과를 받거나, 반대로 Native 코드에서 Java 객체를 제어할 수 있게 해준다.

서로 다른 메모리 구조를 가진 두 언어를 연결하기 때문에, **데이터를 변환하고 전달하는 과정(마샬링)에서 오버헤드가 발생**한다. 따라서 너무 **빈번하게 JNI 를 호출하는 것은 오히려 성능을 저하**시킬 수 있다.

## 프로젝트 구조
전체 구조도

Android Studio 의 Project View 를 Project 로 전환했을떄 아래의 구조가 된다
```
app(Module)
    main
     ├─ cpp
     │   ├─ include(외부 라이브러리를 사용하는 경우 별도 생성)
     │   ├─ CMakeLists.txt
     │   └─ native-lib.cpp
     ├─ java
     │   └─ com
     │       └─ example
     │           └─ sample
     │               ├─ MainActivity
     │               └─ JniBridge.kt(별도 생성)
     └─ JniLibs(외부 라이브러리를 사용하는 경우 아키텍처 별 하위 폴더까지 별도 생성)
            ├─ arm6-v8a
            └─ armeabi-v7a
```
### 1. 새로운 프로젝트를 만들 경우(Android Studio )
1. File -> New Project  
2. Native C++ 선택
    ![프로젝트 생성 - 1](https://host.ggoggo.duckdns.org/Blog/251208_ndk/new_project_1.png)
3. 프로젝트명, 패키지명, 저장위치, 언어(Java/Kotlin), Minimum SDK, Build configuration language 는 기존 프로젝트 생성할때와 동일하게 작성한다.
    ![프로젝트 생성 - 2](https://host.ggoggo.duckdns.org/Blog/251208_ndk/new_project_2.png)
4. C++ 버전을 선택한다. 선택하지 않으면 **C++ 의 지원되는 기능은 NDK 버전에 따라 달라**진다.
    ![프로젝트 생성 - 3](https://host.ggoggo.duckdns.org/Blog/251208_ndk/new_project_3.png)
### 2. 기존 프로젝트에 NDK 를 통합하는 경우
1. Project View 를 Android 에서 Project 로 변경한다.
2. SDK Manager -> SDK Tools 에서 `NDK(Side by side)` 와 `CMake` 를 설치한다. 혹 버전을 선택하여 설치하고 싶다면, 하위의 `Show Package Details` 를 체크하여 원하는 버전을 선택하여 설치한다.
3. main 하위에 new -> Directory `cpp` 를 생성한다.
4. cpp 폴더 하위에 new -> CMakeLists.txt 를 추가한다.
5. cpp 폴더 하위에 new -> C/C++ Source File 을 추가한다. 해당 파일은 JNI 를 통해 통신할 기본적인 cpp 파일이다.
6. 3에서 추가한 `CMakeLists.txt` 에 아래 내용을 기입한다. 각 부분별 설명은 아래에서 자세히 다룬다.
    ```
    # 개발환경에 설치된 CMake 버전을 명시한다.
    cmake_minimum_required(VERSION 3.22.1) 

    # 프로젝트 명을 기재
    project("myapplication")

    # 생성할 라이브러리의 이름. 예를 들어 ndk-test 로 지정하면 빌드 시 libnek-test.so 파일이 빌드된다.
    add_library(library-name SHARED
        # 생성할 라이브러리에 포함될 cpp 파일을 기재한다. 기본적으로 5 에서 추가한 cpp 를 넣어주어야 한다.
        native-lib.cpp)
    
    # 실행파일이 의존하는 다른 라이브러리를 연결한다. 기본적으로 `android` 는 Native 레벨에서 Android OS 의 리소스에 접근하는데 사용되고, `log` 는 Native 코드 레벨에서 로그캣에 출력되는 로그를 사용하기 위함이다.
    target_link_libraries(library-name
        android
        log)
    ```
7. build.gradle(:app) 에서 아래 내용을 추가한다.
    ```
    externalNativeBuild {
        cmake {
            path = file("src/main/cpp/CMakeLists.txt") // CMakeLists.txt 파일이 위치한 경로
            version = "3.22.1" // CMake 버전
        }
    }
    ```
## CMakeLists.txt
`CMakeLists.txt` 파일은 네이티브 코드(C/C++) 를 빌드하는데 필요한 설정을 기재하는 파일. Android 프로젝트를 `gradle` 을 통해서 빌드할때 설정을 `build.gradle` 에 기재하는것과 동일한 역할을 함.

`NDK` 가 포함된 프로젝트를 빌드할 경우, `gradle` 을 통해서 빌드하다가 네이티브 빌드가 있다는 것을 `gradle` 이 인지하고 `CMake` 를 통해 네이티브 소스를 빌드하게 된다.



## JNI 구성

## 사용 예시

## MVVM Pattern(Clean Architecture) 관점